<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test de fluiditÃ©</title>
  <script src="https://unpkg.com/jspsych@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-text-response@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@1.1.1"></script>
  <link href="https://unpkg.com/jspsych@7.3.0/css/jspsych.css" rel="stylesheet">
</head>
<body></body>

<script>
  // âœ… åˆå§‹åŒ– jsPsych
  const jsPsych = initJsPsych({
    on_finish: function() {
      const json_data = jsPsych.data.get().json();
      fetch("https://script.google.com/macros/s/VOTRE_URL_GOOGLE_SCRIPT/exec", {
        method: "POST",
        body: json_data,
        headers: { "Content-Type": "application/json" }
      })
      .then(() => alert("Merci ! Vos rÃ©ponses ont Ã©tÃ© envoyÃ©es avec succÃ¨s."))
      .catch(() => alert("Erreur : l'envoi a Ã©chouÃ©. Veuillez contacter le chercheur."));
    }
  });

  const timeline = [];

  // ğŸ‘¤ ä½¿ç”¨å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ä»£æ›¿å˜é‡
  timeline.push({
    type: 'survey-html-form', // ç›´æ¥ä½¿ç”¨æ’ä»¶æ³¨å†Œå
    preamble: "<h2>Informations sur le participant</h2><p>Merci de rÃ©pondre aux questions ci-dessous.</p>",
    html: `
      <label>Ã‚ge : <input name="age" type="number" required></label><br><br>
      <label>Genre :
        <select name="genre" required>
          <option value="">--Choisir--</option>
          <option value="Homme">Homme</option>
          <option value="Femme">Femme</option>
          <option value="Non-binaire">Non-binaire</option>
          <option value="PrÃ©fÃ©rer ne pas dire">PrÃ©fÃ©rer ne pas dire</option>
        </select>
      </label><br><br>
      <label>Profession : <input name="profession" type="text" required></label><br><br>
      <label>Langue maternelle : <input name="langue_maternelle" type="text" required></label><br><br>
      <label>Langues Ã©trangÃ¨res parlÃ©es : <input name="langues" type="text"></label><br><br>
      <label>Avez-vous appris le chinois ?
        <select name="chinois" required>
          <option value="">--Choisir--</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </label><br><br>
      <label>Utilisez-vous un appareil auditif ?
        <select name="appareil" required>
          <option value="">--Choisir--</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </label>
    `,
    button_label: "Commencer l'expÃ©rience"
  });

  // ğŸ“– Consignes
  timeline.push({
    type: 'html-keyboard-response',
    stimulus: `
      <h1>Jugement de fluiditÃ©</h1>
      <h2>Consignes</h2>
      <p>
      Vous allez Ã©couter 12 extraits audio de personnes lisant un court texte en franÃ§ais.<br><br>
      <strong>Votre tÃ¢che :</strong> Ã‰valuer <strong>UNIQUEMENT</strong> la fluiditÃ© de chaque lecture sur une Ã©chelle de 1 Ã  10.<br><br>
      La fluiditÃ© se dÃ©finit par :<br>
      â±ï¸ Le dÃ©bit : Rythme rÃ©gulier<br>
      â¸ï¸ Les pauses : Aux endroits logiques, sans hÃ©sitations frÃ©quentes<br>
      ğŸ¶ Le flux : Liaisons naturelles, intonation cohÃ©rente<br><br>
      Ignorez :<br>
      âŒ L'accent<br>
      âŒ La prononciation<br>
      âŒ Votre opinion sur le texte<br><br>
      Appuyez sur une touche pour commencer.
      </p>
    `
  });

  // ğŸµ åŠ¨æ€è·å–åŸºç¡€è·¯å¾„
  const base_path = window.location.href.replace(/\/[^\/]*$/, '') + '/';
  
  // âœ… éŸ³é¢‘æ–‡ä»¶åˆ—è¡¨
  let audio_files = [
    `${base_path}audio/1.wav`,
    `${base_path}audio/2.wav`,
    `${base_path}audio/3.wav`,
    `${base_path}audio/4.wav`,
    `${base_path}audio/5.wav`,
    `${base_path}audio/6.wav`,
    `${base_path}audio/7.wav`,
    `${base_path}audio/8.wav`,
    `${base_path}audio/9.wav`,
    `${base_path}audio/10.wav`,
    `${base_path}audio/11.wav`,
    `${base_path}audio/12.wav`
  ];

  // è°ƒè¯•ï¼šæ£€æŸ¥æ–‡ä»¶è·¯å¾„
  console.log("Audio files paths:", audio_files);

  audio_files = jsPsych.randomization.shuffle(audio_files);

  audio_files.forEach(file => {
    timeline.push(
      {
        type: 'audio-keyboard-response',
        stimulus: file,
        choices: "NO_KEYS",
        trial_ends_after_audio: true
      },
      {
        type: 'html-slider-response',
        stimulus: '<p>Sur une Ã©chelle de 1 Ã  10, comment jugez-vous la fluiditÃ© de cet extrait ?</p>',
        min: 1,
        max: 10,
        step: 1,
        slider_start: 5,
        labels: ['1 (Pas fluide)', '10 (TrÃ¨s fluide)'],
        require_movement: true,
        data: { question: 'fluidity_rating', audio: file }
      },
      {
        type: 'html-text-response',
        stimulus: '<p>Pourquoi avez-vous choisi ce chiffre ?</p>',
        placeholder: 'Votre rÃ©ponse ici...',
        rows: 3,
        columns: 60,
        data: { question: 'justification', audio: file }
      }
    );
  });

  // ğŸ‰ Fin de l'expÃ©rience
  timeline.push({
    type: 'html-keyboard-response',
    stimulus: '<p>Merci pour votre participation !<br>Appuyez sur une touche pour envoyer vos rÃ©ponses.</p>'
  });

  // ğŸš€ Lancer l'expÃ©rience
  jsPsych.run(timeline);
</script>
</html>
