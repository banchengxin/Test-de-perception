<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Test de fluidit√©</title>
  <script src="dist/jspsych.js"></script>
  <script src="dist/plugin-audio-keyboard-response.js"></script>
  <script src="dist/plugin-html-slider-response.js"></script>
  <script src="dist/plugin-html-text-response.js"></script>
  <link href="dist/jspsych.css" rel="stylesheet" />
</head>
<body></body>

<script>
  const jsPsych = initJsPsych();

  // Tes 12 extraits audio (modifie les noms si besoin)
  let audio_files = [
    "audio/1.wav",
    "audio/2.wav",
    "audio/3.wav",
    "audio/4.wav",
    "audio/5.wav",
    "audio/6.wav",
    "audio/7.wav",
    "audio/8.wav",
    "audio/9.wav",
    "audio/10.wav",
    "audio/11.wav",
    "audio/12.wav"
  ];

  // M√©langer les extraits
  audio_files = jsPsych.randomization.shuffle(audio_files);

  // Consignes en fran√ßais
  const instructions = {
    type: 'html-keyboard-response',
    stimulus: `
      <h2>Consignes :</h2>
      <p>
      Test de perception
      Jugement de fludit√©
      Vous allez √©couter 12 extraits audio de personnes lisant un court texte en fran√ßais.<br><br>
      Votre t√¢che : √âvaluer <b>UNIQUEMENT</b> la fluidit√© de chaque lecture sur une √©chelle de 1 √† 10.<br><br>
      La fluidit√© se d√©finit par :<br>
      ‚è±Ô∏è Le d√©bit : Rythme r√©gulier,<br>
      ‚è∏Ô∏è Les pauses : Aux endroits logiques (virgules, points), sans h√©sitations fr√©quentes ("euh...")<br>
      üé∂ Le flux : Liaisons naturelles entre les mots, intonation coh√©rente<br><br>
      Ignorez :<br>
      ‚ùå L'accent ou la prononciation des sons individuels<br>
      ‚ùå La complexit√© du vocabulaire<br>
      ‚ùå Votre opinion sur le contenu du texte<br><br>
      Appuyez sur une touche pour commencer.
      </p>`,
  };

  // Timeline
  let timeline = [];
  timeline.push(instructions);

  // Pour chaque extrait : jouer audio ‚Üí √©chelle 1-10 ‚Üí raison
  audio_files.forEach((audio_src, i) => {
    // Lecture audio (plugin audio-keyboard-response)
    let audio_trial = {
      type: 'audio-keyboard-response',
      stimulus: audio_src,
      choices: "NO_KEYS",
      trial_ends_after_audio: true,
    };

    // √âchelle de fluidit√© (plugin html-slider-response)
    let slider_trial = {
      type: 'html-slider-response',
      stimulus: `<p>Sur une √©chelle de 1 √† 10, comment jugez-vous la fluidit√© de cet extrait ?</p>`,
      min: 1,
      max: 10,
      step: 1,
      slider_start: 5,
      require_movement: true,
      labels: ['1', '10'],
    };

    // Question ouverte (plugin html-text-response)
    let text_trial = {
      type: 'html-text-response',
      stimulus: `<p>Pourquoi avez-vous choisi ce chiffre ?</p>`,
      placeholder: 'Votre r√©ponse ici...',
      rows: 3,
      columns: 50,
      button_label: "Continuer"
    };

    timeline.push(audio_trial, slider_trial, text_trial);
  });

  // Fin de l'exp√©rience
  let goodbye = {
    type: 'html-keyboard-response',
    stimulus: '<p>Merci pour votre participation ! Appuyez sur une touche pour terminer.</p>'
  };
  timeline.push(goodbye);

  // Initialisation jsPsych avec envoi des donn√©es au Google Apps Script
  jsPsych.init({
    timeline: timeline,
    on_finish: function() {
      const data = jsPsych.data.get().json();
      fetch("https://script.google.com/macros/s/AKfycbwFD7kKQ36cgH9MoKcDhHI72Om3xV9rAeovT57uYIpiIg7GlPNqOUyKum9kDe_qaAjC/exec", {
        method: "POST",
        body: data,
        headers: {
          "Content-Type": "application/json"
        }
      }).then(() => {
        alert("Merci ! Vos r√©ponses ont √©t√© envoy√©es.");
      }).catch(() => {
        alert("Erreur : vos donn√©es n'ont pas √©t√© envoy√©es.");
      });
    }
  });
</script>

</html>
