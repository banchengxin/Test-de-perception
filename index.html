<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test de fluidit√©</title>
  <script src="https://unpkg.com/jspsych@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-audio-keyboard-response@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-text-response@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@7.3.0"></script>
  <script src="https://unpkg.com/@jspsych/plugin-survey-html-form@7.3.0"></script>
  <link href="https://unpkg.com/jspsych@7.3.0/css/jspsych.css" rel="stylesheet">
</head>
<body></body>

<script>
  // ÂàùÂßãÂåñ jsPsych
  const jsPsych = initJsPsych({
    on_finish: function() {
      const json_data = jsPsych.data.get().json();
      fetch("https://script.google.com/macros/s/VOTRE_URL_GOOGLE_SCRIPT/exec", {
        method: "POST",
        body: json_data,
        headers: { "Content-Type": "application/json" }
      })
      .then(() => alert("Merci ! Vos r√©ponses ont √©t√© envoy√©es avec succ√®s."))
      .catch(() => alert("Erreur : l'envoi a √©chou√©. Veuillez contacter le chercheur."));
    }
  });

  const timeline = [];

  timeline.push({
    type: 'survey-html-form',
    preamble: "<h2>Informations sur le participant</h2><p>Merci de r√©pondre aux questions ci-dessous.</p>",
    html: `
      <label>√Çge : <input name="age" type="number" required></label><br><br>
      <label>Genre :
        <select name="genre" required>
          <option value="">--Choisir--</option>
          <option value="Homme">Homme</option>
          <option value="Femme">Femme</option>
          <option value="Non-binaire">Non-binaire</option>
          <option value="Pr√©f√©rer ne pas dire">Pr√©f√©rer ne pas dire</option>
        </select>
      </label><br><br>
      <label>Profession : <input name="profession" type="text" required></label><br><br>
      <label>Langue maternelle : <input name="langue_maternelle" type="text" required></label><br><br>
      <label>Langues √©trang√®res parl√©es : <input name="langues" type="text"></label><br><br>
      <label>Avez-vous appris le chinois ?
        <select name="chinois" required>
          <option value="">--Choisir--</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </label><br><br>
      <label>Utilisez-vous un appareil auditif ?
        <select name="appareil" required>
          <option value="">--Choisir--</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </label>
    `,
    button_label: "Commencer l'exp√©rience"
  });

  timeline.push({
    type: 'html-keyboard-response',
    stimulus: `
      <h1>Jugement de fluidit√©</h1>
      <h2>Consignes</h2>
      <p>
      Vous allez √©couter 12 extraits audio de personnes lisant un court texte en fran√ßais.<br><br>
      <strong>Votre t√¢che :</strong> √âvaluer <strong>UNIQUEMENT</strong> la fluidit√© de chaque lecture sur une √©chelle de 1 √† 10.<br><br>
      La fluidit√© se d√©finit par :<br>
      ‚è±Ô∏è Le d√©bit : Rythme r√©gulier<br>
      ‚è∏Ô∏è Les pauses : Aux endroits logiques, sans h√©sitations fr√©quentes<br>
      üé∂ Le flux : Liaisons naturelles, intonation coh√©rente<br><br>
      Ignorez :<br>
      ‚ùå L'accent<br>
      ‚ùå La prononciation<br>
      ‚ùå Votre opinion sur le texte<br><br>
      Appuyez sur une touche pour commencer.
      </p>
    `
  });

  const base_path = window.location.href.replace(/\/[^\/]*$/, '') + '/';

  let audio_files = [
    `${base_path}audio/1.wav`,
    `${base_path}audio/2.wav`,
    `${base_path}audio/3.wav`,
    `${base_path}audio/4.wav`,
    `${base_path}audio/5.wav`,
    `${base_path}audio/6.wav`,
    `${base_path}audio/7.wav`,
    `${base_path}audio/8.wav`,
    `${base_path}audio/9.wav`,
    `${base_path}audio/10.wav`,
    `${base_path}audio/11.wav`,
    `${base_path}audio/12.wav`
  ];

  console.log("Audio files paths:", audio_files);

  audio_files = jsPsych.randomization.shuffle(audio_files);

  audio_files.forEach(file => {
    timeline.push(
      {
        type: 'audio-keyboard-response',
        stimulus: file,
        choices: "NO_KEYS",
        trial_ends_after_audio: true
      },
      {
        type: 'html-slider-response',
        stimulus: '<p>Sur une √©chelle de 1 √† 10, comment jugez-vous la fluidit√© de cet extrait ?</p>',
        min: 1,
        max: 10,
        step: 1,
        slider_start: 5,
        labels: ['1 (Pas fluide)', '10 (Tr√®s fluide)'],
        require_movement: true,
        data: { question: 'fluidity_rating', audio: file }
      },
      {
        type: 'html-text-response',
        stimulus: '<p>Pourquoi avez-vous choisi ce chiffre ?</p>',
        placeholder: 'Votre r√©ponse ici...',
        rows: 3,
        columns: 60,
        data: { question: 'justification', audio: file }
      }
    );
  });

  timeline.push({
    type: 'html-keyboard-response',
    stimulus: '<p>Merci pour votre participation !<br>Appuyez sur une touche pour envoyer vos r√©ponses.</p>'
  });

  jsPsych.run(timeline);
</script>
</html>
