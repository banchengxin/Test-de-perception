<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Test de fluidit√©</title>

  <!-- jsPsych v7+ -->
  <script src="dist/jspsych.js"></script>
  <script src="dist/plugin-audio-keyboard-response.js"></script>
  <script src="dist/plugin-html-slider-response.js"></script>
  <script src="dist/plugin-html-text-response.js"></script>
  <script src="dist/plugin-html-keyboard-response.js"></script>
  <script src="dist/plugin-survey-html-form.js"></script>
  <link href="dist/jspsych.css" rel="stylesheet">
</head>
<body></body>

<script>
  // ‚úÖ ÂàùÂßãÂåñ jsPsych
  const jsPsych = initJsPsych({
    on_finish: function () {
      const json_data = jsPsych.data.get().json();
      fetch("https://script.google.com/macros/s/AKfycbwFD7kKQ36cgH9MoKcDhHI72Om3xV9rAeovT57uYIpiIg7GlPNqOUyKum9kDe_qaAjC/exec", {
        method: "POST",
        body: json_data,
        headers: {
          "Content-Type": "application/json"
        }
      })
      .then(() => alert("Merci ! Vos r√©ponses ont √©t√© envoy√©es avec succ√®s."))
      .catch(() => alert("Erreur : l'envoi a √©chou√©. Veuillez contacter le chercheur."));
    }
  });

  // ‚úÖ Ëé∑ÂèñÊèí‰ª∂ÂØπË±°
  const jsPsychHtmlKeyboardResponse = window.jsPsychHtmlKeyboardResponse;
  const jsPsychHtmlSliderResponse = window.jsPsychHtmlSliderResponse;
  const jsPsychHtmlTextResponse = window.jsPsychHtmlTextResponse;
  const jsPsychSurveyHtmlForm = window.jsPsychSurveyHtmlForm;
  const jsPsychAudioKeyboardResponse = window.jsPsychAudioKeyboardResponse;

  const timeline = [];

  // üë§ Questionnaire
  timeline.push({
    type: jsPsychSurveyHtmlForm,
    preamble: "<h2>Informations sur le participant</h2><p>Merci de r√©pondre aux questions ci-dessous.</p>",
    html: `
      <label>√Çge : <input name="age" type="number" required></label><br><br>
      <label>Genre :
        <select name="genre" required>
          <option value="">--Choisir--</option>
          <option value="Homme">Homme</option>
          <option value="Femme">Femme</option>
          <option value="Non-binaire">Non-binaire</option>
          <option value="Pr√©f√©rer ne pas dire">Pr√©f√©rer ne pas dire</option>
        </select>
      </label><br><br>
      <label>Profession : <input name="profession" type="text" required></label><br><br>
      <label>Langue maternelle : <input name="langue_maternelle" type="text" required></label><br><br>
      <label>Langues √©trang√®res parl√©es : <input name="langues" type="text"></label><br><br>
      <label>Avez-vous appris le chinois ?
        <select name="chinois" required>
          <option value="">--Choisir--</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </label><br><br>
      <label>Utilisez-vous un appareil auditif ?
        <select name="appareil" required>
          <option value="">--Choisir--</option>
          <option value="Oui">Oui</option>
          <option value="Non">Non</option>
        </select>
      </label>
    `,
    button_label: "Commencer l'exp√©rience"
  });

  // üìñ Consignes
  timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
      <h1>Jugement de fluidit√©</h1>
      <h2>Consignes</h2>
      <p>
      Vous allez √©couter 12 extraits audio de personnes lisant un court texte en fran√ßais.<br><br>
      <strong>Votre t√¢che :</strong> √âvaluer <strong>UNIQUEMENT</strong> la fluidit√© de chaque lecture sur une √©chelle de 1 √† 10.<br><br>
      La fluidit√© se d√©finit par :<br>
      ‚è±Ô∏è Le d√©bit : Rythme r√©gulier<br>
      ‚è∏Ô∏è Les pauses : Aux endroits logiques (virgules, points), sans h√©sitations fr√©quentes ("euh...")<br>
      üé∂ Le flux : Liaisons naturelles entre les mots, intonation coh√©rente<br><br>
      Ignorez :<br>
      ‚ùå L'accent ou la prononciation des sons individuels<br>
      ‚ùå La complexit√© du vocabulaire<br>
      ‚ùå Votre opinion sur le contenu du texte<br><br>
      Appuyez sur une touche pour commencer.
      </p>
    `
  });

  // üéß Audio files
  let audio_files = [
    "audio/1.wav", "audio/2.wav", "audio/3.wav", "audio/4.wav",
    "audio/5.wav", "audio/6.wav", "audio/7.wav", "audio/8.wav",
    "audio/9.wav", "audio/10.wav", "audio/11.wav", "audio/12.wav"
  ];

  audio_files = jsPsych.randomization.shuffle(audio_files);

  // üß™ Boucle audio + slider + justification
  audio_files.forEach((file) => {
    timeline.push(
      {
        type: jsPsychAudioKeyboardResponse,
        stimulus: file,
        choices: "NO_KEYS",
        trial_ends_after_audio: true
      },
      {
        type: jsPsychHtmlSliderResponse,
        stimulus: '<p>Sur une √©chelle de 1 √† 10, comment jugez-vous la fluidit√© de cet extrait ?</p>',
        min: 1,
        max: 10,
        step: 1,
        slider_start: 5,
        labels: ['1', '10'],
        require_movement: true,
        data: { question: 'fluidity_rating', audio: file }
      },
      {
        type: jsPsychHtmlTextResponse,
        stimulus: '<p>Pourquoi avez-vous choisi ce chiffre ?</p>',
        placeholder: 'Votre r√©ponse ici...',
        rows: 3,
        columns: 60,
        data: { question: 'justification', audio: file }
      }
    );
  });

  // üéâ Fin
  timeline.push({
    type: jsPsychHtmlKeyboardResponse,
    stimulus: '<p>Merci pour votre participation !<br>Appuyez sur une touche pour envoyer vos r√©ponses.</p>'
  });

  // üöÄ D√©marrer l'exp√©rience
  jsPsych.run(timeline);
</script>
</html>
